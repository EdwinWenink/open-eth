server {
	listen 80 default_server;
	listen [::]:80 default_server ipv6only=on;
	access_log /dev/stdout;
	error_log /dev/stdout;
	charset utf-8;
	
	# Serve static files
	root /srv/openeth/www;
	
	# Other combinations
	try_files $uri $uri.min.html $uri.html $uri/index.html =404;
	
	# Proxy api requests to the PostgREST
	location /api/ {
		
		proxy_pass http://api:3000/;
		
		# Rewrite Content-Location header
		proxy_hide_header Content-Location;
		add_header  Content-Location  /api$upstream_http_content_location;
		proxy_hide_header Location;
		add_header  Location  /api$upstream_http_location;
	}
	
	# Proxy ACME challenges to letsencrypt
	location /.well-known/acme-challenge {
		proxy_pass http://len:80;
	}
	
	error_page 404 /not-found;
}
